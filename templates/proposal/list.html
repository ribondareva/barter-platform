{% extends "base.html" %}

{% block title %}–ú–æ–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è{% endblock %}

{% block content %}
<h2>–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ–±–º–µ–Ω–∞</h2>

<form method="get" class="filter-form">
    <div class="filter-block">
        <label for="status">–°—Ç–∞—Ç—É—Å</label>
        <select name="status" id="status">
            <option value="">–í—Å–µ</option>
            <option value="pending" {% if request.GET.status == 'pending' %}selected{% endif %}>–û–∂–∏–¥–∞–µ—Ç</option>
            <option value="accepted" {% if request.GET.status == 'accepted' %}selected{% endif %}>–ü—Ä–∏–Ω—è—Ç–æ</option>
            <option value="rejected" {% if request.GET.status == 'rejected' %}selected{% endif %}>–û—Ç–∫–ª–æ–Ω–µ–Ω–æ</option>
        </select>
    </div>

    <div class="filter-block">
        <label for="sender">–ß—Ç–æ —è –ø—Ä–µ–¥–ª–∞–≥–∞—é</label>
        <select name="sender" id="sender">
            <option value="">–í—Å–µ</option>
            {% for ad in user_ads %}
                <option value="{{ ad.id }}" {% if request.GET.sender == ad.id|stringformat:"s" %}selected{% endif %}>
                    {{ ad.title|slice:":20" }}{% if ad.title|length > 20 %}...{% endif %}
                </option>
            {% endfor %}
        </select>
    </div>

    <div class="filter-block">
        <label for="receiver">–ß—Ç–æ —Ö–æ—á—É –ø–æ–ª—É—á–∏—Ç—å</label>
        <select name="receiver" id="receiver">
            <option value="">–í—Å–µ</option>
            {% for ad in other_ads %}
                <option value="{{ ad.id }}" {% if request.GET.receiver == ad.id|stringformat:"s" %}selected{% endif %}>
                    {{ ad.title|slice:":15" }}{% if ad.title|length > 15 %}...{% endif %}
                </option>
            {% endfor %}
        </select>
    </div>

    <div class="filter-block">
        <label>&nbsp;</label>
        <div class="button-row">
            <button type="submit" class="filter-button">–ù–∞–π—Ç–∏</button>
            <button type="button" class="filter-button reset-button" onclick="window.location.href='{% url 'proposal_list' %}'">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ</button>
        </div>
    </div>
</form>


<ul>
{% for p in proposals %}
    <li class="proposal-item">
        <strong>–û—Ç:</strong> {{ p.ad_sender.title }} ‚Üí
        <strong>–ö:</strong> {{ p.ad_receiver.title }} |
        <strong>–°—Ç–∞—Ç—É—Å:</strong>
        {% if p.status == "accepted" %}
            <span style="color:green;">‚úÖ –ü—Ä–∏–Ω—è—Ç–æ</span>
        {% elif p.status == "rejected" %}
            <span style="color:red;">‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ</span>
        {% else %}
            üü° –û–∂–∏–¥–∞–µ—Ç
        {% endif %}
        |
        <strong>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</strong> {{ p.comment }}

        {% if p.ad_receiver.user == request.user and p.status == 'pending' %}
            <form action="{% url 'proposal_update' p.id %}" method="post" style="display:inline;">
                {% csrf_token %}
                <button name="status" value="accepted">–ü—Ä–∏–Ω—è—Ç—å</button>
                <button name="status" value="rejected">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
            </form>
        {% endif %}
    </li>
{% empty %}
    <li class="proposal-empty">
        {% if request.GET %}
            –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ —Ç–µ–∫—É—â–∏–º —Ñ–∏–ª—å—Ç—Ä–∞–º.
        {% else %}
            –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –æ–±–º–µ–Ω–∞.
        {% endif %}
    </li>
{% endfor %}
</ul>
{% endblock %}
